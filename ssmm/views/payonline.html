{{template "base/base.html" .}}
{{define "head"}}{{end}}
{{define "meta"}}
<title>{{.Title}} - beego: {{i18n .Lang "app_intro"}}</title>
<link rel="stylesheet" href="/static/css/cartstyle.css" />
<script src="/static/js/pingpp_pay.js" type="text/javascript"></script>
{{end}}
{{define "body"}}
<div class="container main-container">
	<div class="row">
		<div class="col-md-12">
			<div class="box">
				<div class="cell slim page-box">
					<div id="order-cart">

						<h1>在线支付</h1>

						<h2>您应该支付 <strong>￥{{.total}}RMB</strong></h2>
						<input type="hidden" id="amount" value="{{.total}}" />
						<p align="center"><input type="button" onclick="wap_pay('upacp_pc')" id="sub" value="立即支付" /></p>
						<script>
						    function wap_pay(channel) {
						    	document.getElementById('sub').value="请稍后...";
						        var amount = document.getElementById('amount').value * 100;

						        var xhr = new XMLHttpRequest();
						        xhr.open("POST", "/pay", true);
						        xhr.setRequestHeader("Content-type", "application/json");
						        xhr.send(JSON.stringify({
						            channel: channel,
						            amount: amount
						        }));

						        xhr.onreadystatechange = function () {
						            if (xhr.readyState == 4 && xhr.status == 200) {
						                console.log(xhr.responseText);
						                pingpp.createPayment(xhr.responseText, function(result, err) {
						                    console.log(result);
						                    console.log(err);
						                });
						            }
						        }
						    }
						</script>

					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{{end}}